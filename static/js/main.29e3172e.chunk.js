(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r,a,o,c=n(1),i=n(2),u=n.n(i),s=n(8),l=n.n(s),p=(n(15),n(16),n.p+"static/media/clear1.fe1236db.mp3"),f=n.p+"static/media/clear2.42d27630.mp3",d=n.p+"static/media/clear3.50cd846e.mp3",h=n.p+"static/media/clear4.529df8a4.mp3",m=n.p+"static/media/gameOver.f52cf5f0.mp3",j=n.p+"static/media/hardDrop.d2d4cb32.mp3",b=n.p+"static/media/locked.f92eb651.mp3",v=n.p+"static/media/spawn.dcb5ecc2.mp3",O=n(4),y=n(0),g=function(e,t){var n=t.length;return e.shape.some((function(r,a){return r.some((function(r,o){return r&&(a+e.top>=n-1||t[a+e.top+1][o+e.left])}))}))},w=n(3),x=function(e,t,n){return function(e,t){var n=t[0].length,r=t.length;return!e.shape.some((function(a,o){return a.some((function(a,c){return a&&(c+e.left<0||c+e.left>=n||o+e.top>=r||t[o+e.top][c+e.left])}))}))}(e,n)?e:t},k=function(e,t){return x(Object(y.a)(Object(y.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,r){return e.shape[e.shape.length-1-r][n]}))}))}),e,t)},N=37,A=39,P=40,E=(r={},Object(w.a)(r,N,{left:-1,top:0}),Object(w.a)(r,A,{left:1,top:0}),Object(w.a)(r,P,{left:0,top:1}),r),L=function(e,t,n){return x(Object(y.a)(Object(y.a)({},e),{},{left:e.left+E[n].left,top:e.top+E[n].top}),e,t)},C=function(e,t){return t.map((function(t,n){return t.map((function(t,r){var a;return t||(null===(a=e.shape[n-e.top])||void 0===a?void 0:a[r-e.left])}))}))},D=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.top,a=Object(y.a)(Object(y.a)({},t),{},{top:r});return g(a,n)?a:e(t,n,r+1)},T=function(e,t){return Object(O.a)(Array(t)).map((function(){return Object(O.a)(Array(e)).map((function(){}))}))},q="spawning",M="descending",R="locking",I="clearing",S="gameOver",F="starting",B="pending",J="paused",U="resuming",z=function(e){var t=function(e,t){var n=g(e,t);return{playfield:n?C(e,t):t,locked:n}}(e.tetromino,e.playfield);return t.locked?Object(y.a)(Object(y.a)({},e),{},{tetromino:void 0,ghostPiece:void 0,playfield:t.playfield,sfx:"locked",phase:I}):Object(y.a)(Object(y.a)({},e),{},{phase:M})},X={tick:function(e){var t=e.tetromino,n=e.playfield,r=L(t,n,P);return Object(y.a)(Object(y.a)({},e),{},{tetromino:r,phase:g(r,n)?R:e.phase})},move:function(e,t){var n=e.tetromino,r=e.playfield,a=L(n,r,t.payload);return e.phase===R&&t.payload===P?z(e):Object(y.a)(Object(y.a)({},e),{},{tetromino:a,ghostPiece:D(a,r),phase:g(a,r)?R:M})},lock:z,clear:function(e){var t=function(e){var t=e[0].length,n=e.reduceRight((function(e,t){return t.every((function(e){return e}))?e:[t].concat(e)}),[]),r=e.length-n.length;return{playfield:T(t,r).concat(n),linesCleared:r}}(e.playfield),n=e.lines+t.linesCleared;return Object(y.a)(Object(y.a)({},e),{},{playfield:t.playfield,lines:n,sfx:t.linesCleared>0?"clear"+t.linesCleared:void 0,interval:Math.max(100,1e3-100*Math.floor(n/10)),phase:q})},rotateRight:function(e){var t=e.tetromino,n=e.playfield,r=k(t,n);return Object(y.a)(Object(y.a)({},e),{},{tetromino:k(t,n),ghostPiece:D(r,n)})},rotateLeft:function(e){var t=e.tetromino,n=e.playfield,r=function(e,t){return x(Object(y.a)(Object(y.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,r){return e.shape[r][e.shape.length-1-n]}))}))}),e,t)}(t,n);return Object(y.a)(Object(y.a)({},e),{},{tetromino:r,ghostPiece:D(r,n)})},spawn:function(e,t){var n=e.queue,r=e.playfield,a=n[0],o=n.slice(1).concat(t.payload||[]),c=function(e,t){return!e.shape.some((function(n,r){return n.some((function(n,a){return n&&t[r+e.top][a+e.left]}))}))}(a,r);return Object(y.a)(Object(y.a)({},e),{},{tetromino:a,ghostPiece:D(a,r),phase:c?M:S,sfx:c?"spawn":"gameOver",queue:o,alive:c})},hardDrop:function(e){var t=e.tetromino,n=e.playfield,r=D(t,n);return Object(y.a)(Object(y.a)({},e),{},{tetromino:r,sfx:"hardDrop",phase:R})},start:function(e,t){return{playfield:Object(O.a)(Array(20)).map((function(){return Object(O.a)(Array(10)).map((function(){}))})),queue:t.payload,phase:F,tetromino:void 0,alive:!0,interval:1e3,lines:0,countdown:3,originalPhase:void 0}},countdown:function(e){return Object(y.a)(Object(y.a)({},e),{},{countdown:Math.max(0,e.countdown-1)})},pause:function(e){return Object(y.a)(Object(y.a)({},e),{},{phase:J,originalPhase:e.phase})},resume:function(e){return Object(y.a)(Object(y.a)({},e),{},{phase:U,countdown:3})},restore:function(e){return Object(y.a)(Object(y.a)({},e),{},{phase:e.originalPhase,originalPhase:void 0})}},Y={tick:[M],move:[M,R],lock:[R],clear:[I],rotateLeft:[M,R],rotateRight:[M,R],spawn:[q,F],hardDrop:[M],start:[B,S],countdown:[F,U],pause:[M,R,I,q],resume:[J],restore:[U]},Z=function(e,t){var n;return(null===(n=Y[t.type])||void 0===n?void 0:n.includes(e.phase))?X[t.type](e,t):e},G={playfield:Object(O.a)(Array(20)).map((function(){return Object(O.a)(Array(10)).map((function(){}))})),queue:[],phase:B,tetromino:void 0,alive:!1,interval:1e3,lines:0,countdown:0},H=function(e){return function(){var t=e(),n=t.state,r=t.start,a=t.resume,o=function(e,t,n){var r;return e&&(null===(r=e.shape[n-e.top])||void 0===r?void 0:r[t-e.left])};return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)("main",{className:"frame",children:[Object(c.jsx)("div",{"data-testid":"playfield",className:"playfield",children:n.playfield.map((function(e,t){return Object(c.jsx)("div",{className:"row"+("clearing"===n.phase&&e.every((function(e){return e}))?" clearing":""),children:e.map((function(e,r){return Object(c.jsx)("div",{className:o(n.tetromino,r,t)||(o(n.ghostPiece,r,t)?"ghost-piece":"")||e||""},r)}))},t)}))}),n.phase===B||n.phase===S?Object(c.jsx)("div",{className:"controls",children:Object(c.jsx)("button",{onClick:r,children:"PLAY"})}):null,n.phase===J?Object(c.jsx)("div",{className:"controls",children:Object(c.jsx)("button",{onClick:a,children:"RESUME"})}):null,n.countdown>0?Object(c.jsx)("div",{className:"countdown",children:n.countdown}):null]}),Object(c.jsxs)("div",{className:"frame",children:[Object(c.jsx)("h1",{children:"NEXT"}),Object(c.jsx)("div",{className:"next-tetrominoes",children:n.queue.slice(0,3).map((function(e,t){return Object(c.jsx)("div",{className:"next-tetromino",children:e.shape.map((function(e,t){return Object(c.jsx)("div",{className:"row",children:e.map((function(e,t){return Object(c.jsx)("div",{className:e},t)}))},t)}))},t)}))}),Object(c.jsx)("h1",{children:"LINES"}),Object(c.jsx)("div",{className:"lines",children:n.lines})]})]})}},K=n(9),Q={ArrowLeft:{type:"move",payload:N},ArrowRight:{type:"move",payload:A},ArrowDown:{type:"move",payload:P},ArrowUp:{type:"rotateRight"}," ":{type:"hardDrop"},Escape:{type:"pause"},z:{type:"rotateLeft"}},V=void 0,W="O",$={top:0,left:4,name:W,shape:[[W,W],[W,W]]},_="I",ee={top:0,left:3,name:_,shape:[[V,V,V,V],[_,_,_,_],[V,V,V,V],[V,V,V,V]]},te="S",ne={top:0,left:3,name:te,shape:[[V,te,te],[te,te,V],[V,V,V]]},re="Z",ae={top:0,left:3,name:re,shape:[[re,re,V],[V,re,re],[V,V,V]]},oe="T",ce={top:0,left:3,name:oe,shape:[[V,oe,V],[oe,oe,oe],[V,V,V]]},ie="J",ue={top:0,left:3,name:ie,shape:[[ie,V,V],[ie,ie,ie],[V,V,V]]},se="L",le={top:0,left:3,name:se,shape:[[V,V,se],[se,se,se],[V,V,V]]},pe=function(e){var t=new e,n=function(e){var n=function(e){return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return t.decodeAudioData(e)}))}(e);return function(){return n.then((function(e){var n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start()}))}};return{clear1:n(p),clear2:n(f),clear3:n(d),clear4:n(h),locked:n(b),spawn:n(v),hardDrop:n(j),gameOver:n(m)}}(AudioContext),fe=H((a=pe,o=function(){return function(e){for(var t=e.slice(0),n=t.slice(0).length-1;n>=0;){var r=Math.floor(Math.random()*(n+1)),a=t[n];t[n]=t[r],t[r]=a,n-=1}return t}([ee,$,ce,ne,ae,ue,le])},function(){var e=Object(i.useReducer)(Z,G),t=Object(K.a)(e,2),n=t[0],r=t[1],c=n.alive&&void 0!==n.tetromino&&n.phase!==J;return Object(i.useEffect)((function(){var e=c?setInterval((function(){return r({type:"tick"})}),n.interval):0;return function(){return clearInterval(e)}}),[c,n.interval]),Object(i.useEffect)((function(){n.sfx&&a[n.sfx]()}),[n.sfx]),Object(i.useEffect)((function(){var e,t,a=(e={},Object(w.a)(e,q,(function(){return setTimeout((function(){return r({type:"spawn",payload:n.queue.length<=3?o():[]})}),500)})),Object(w.a)(e,R,(function(){return setTimeout((function(){return r({type:"lock"})}),500)})),Object(w.a)(e,I,(function(){return setTimeout((function(){return r({type:"clear"})}),500)})),Object(w.a)(e,F,(function(){n.countdown>0?setTimeout((function(){return r({type:"countdown"})}),1e3):r({type:"spawn",payload:o()})})),Object(w.a)(e,U,(function(){n.countdown>0?setTimeout((function(){return r({type:"countdown"})}),1e3):r({type:"restore"})})),e);null===(t=a[n.phase])||void 0===t||t.call(a)}),[n.phase,n.queue.length,n.countdown]),Object(i.useEffect)((function(){var e=function(e){Q[e.key]&&r(Q[e.key])};return n.alive&&document.body.addEventListener("keydown",e),function(){return document.body.removeEventListener("keydown",e)}}),[n.alive]),{state:n,start:function(){return r({type:"start",payload:o()})},resume:function(){return r({type:"resume"})}}})),de=function(){return Object(c.jsx)(fe,{})},he=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,18)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),r(e),a(e),o(e),c(e)}))};l.a.render(Object(c.jsx)(u.a.StrictMode,{children:Object(c.jsx)(de,{})}),document.getElementById("root")),he()}},[[17,1,2]]]);
//# sourceMappingURL=main.29e3172e.chunk.js.map