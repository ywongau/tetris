(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{10:function(e,t,a){},11:function(e,t,a){"use strict";a.r(t);var o=a(0),n=a(1),s=a.n(n),r=a(3),l=a.n(r),c=(a(9),a(10),a.p+"static/media/clear1.fe1236db.mp3"),i=a.p+"static/media/clear2.42d27630.mp3",p=a.p+"static/media/clear3.50cd846e.mp3",d=a.p+"static/media/clear4.529df8a4.mp3",h=a.p+"static/media/gameOver.f52cf5f0.mp3",m=a.p+"static/media/hardDrop.d2d4cb32.mp3",u=a.p+"static/media/locked.f92eb651.mp3",f=a.p+"static/media/spawn.dcb5ecc2.mp3";const v="spawning",y="descending",g="locking",j="clearing",b="gameOver",w="starting",x="pending",O="paused",k="resuming";var N=e=>()=>{const{state:t,start:a,resume:n}=e(),s=(e,t,a)=>{var o;return e&&(null===(o=e.shape[a-e.top])||void 0===o?void 0:o[t-e.left])};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("main",{className:"frame",children:[Object(o.jsx)("div",{"data-testid":"playfield",className:"playfield",children:t.playfield.map(((e,a)=>Object(o.jsx)("div",{className:"row"+("clearing"===t.phase&&e.every((e=>e))?" clearing":""),children:e.map(((e,n)=>Object(o.jsx)("div",{className:s(t.tetromino,n,a)||(s(t.ghostPiece,n,a)?"ghost-piece":"")||e||""},n)))},a)))}),t.phase===x||t.phase===b?Object(o.jsx)("div",{className:"controls",children:Object(o.jsx)("button",{onClick:a,children:"PLAY"})}):null,t.phase===O?Object(o.jsx)("div",{className:"controls",children:Object(o.jsx)("button",{onClick:n,children:"RESUME"})}):null,t.countdown>0?Object(o.jsx)("div",{className:"countdown",children:t.countdown}):null]}),Object(o.jsxs)("div",{className:"frame",children:[Object(o.jsx)("h1",{children:"NEXT"}),Object(o.jsx)("div",{className:"next-tetrominos",children:t.queue.slice(0,3).map(((e,t)=>Object(o.jsx)("div",{className:"next-tetromino",children:e.shape.map(((e,t)=>Object(o.jsx)("div",{className:"row",children:e.map(((e,t)=>Object(o.jsx)("div",{className:e},t)))},t)))},t)))}),Object(o.jsx)("h1",{children:"LINES"}),Object(o.jsx)("div",{className:"lines",children:t.lines})]})]})};const P=37,E=39,L=40,A={[P]:{left:-1,top:0},[E]:{left:1,top:0},[L]:{left:0,top:1}},C=(e,t)=>{const a=t.length;return e.shape.some(((o,n)=>o.some(((o,s)=>o&&(n+e.top>=a-1||t[n+e.top+1][s+e.left])))))},D=(e,t,a)=>((e,t)=>{const a=t[0].length,o=t.length;return!e.shape.some(((n,s)=>n.some(((n,r)=>n&&(r+e.left<0||r+e.left>=a||s+e.top>=o||t[s+e.top][r+e.left])))))})(e,a)?e:t,T=(e,t)=>D({...e,shape:e.shape.map(((t,a)=>t.map(((t,o)=>e.shape[e.shape.length-1-o][a]))))},e,t),R=(e,t,a)=>D({...e,left:e.left+A[a].left,top:e.top+A[a].top},e,t),q=(e,t)=>t.map(((t,a)=>t.map(((t,o)=>{var n;return t||(null===(n=e.shape[a-e.top])||void 0===n?void 0:n[o-e.left])})))),M=(e,t,a=e.top)=>{const o={...e,top:a};return C(o,t)?o:M(e,t,a+1)},F=(e,t)=>[...Array(t)].map((()=>[...Array(e)].map((()=>{})))),I=[...Array(22)].map((()=>[...Array(10)].map((()=>{})))),S=e=>{const{tetromino:t,playfield:a}=e,o=((e,t)=>{const a=C(e,t);return{playfield:a?q(e,t):t,locked:a}})(t,a);return o.locked?{...e,tetromino:void 0,ghostPiece:void 0,playfield:o.playfield,sfx:"locked",phase:j}:{...e,phase:y}},B={tick:e=>{const{tetromino:t,playfield:a}=e,o=R(t,a,L);return{...e,tetromino:o,phase:C(o,a)?g:e.phase}},move:(e,t)=>{const{tetromino:a,playfield:o}=e,n=R(a,o,t.payload);return e.phase===g&&t.payload===L?S(e):{...e,tetromino:n,ghostPiece:M(n,o),phase:C(n,o)?g:y}},lock:S,clear:e=>{const{playfield:t}=e,a=(e=>{const t=e[0].length,a=e.reduceRight(((e,t)=>t.every((e=>e))?e:[t].concat(e)),[]),o=e.length-a.length;return{playfield:F(t,o).concat(a),linesCleared:o}})(t),o=e.lines+a.linesCleared;return{...e,playfield:a.playfield,lines:o,sfx:a.linesCleared>0?"clear"+a.linesCleared:void 0,interval:Math.max(100,1e3-100*Math.floor(o/10)),phase:v}},rotateRight:e=>{const{tetromino:t,playfield:a}=e,o=T(t,a);return{...e,tetromino:T(t,a),ghostPiece:M(o,a)}},rotateLeft:e=>{const{tetromino:t,playfield:a}=e,o=((e,t)=>D({...e,shape:e.shape.map(((t,a)=>t.map(((t,o)=>e.shape[o][e.shape.length-1-a]))))},e,t))(t,a);return{...e,tetromino:o,ghostPiece:M(o,a)}},spawn:(e,t)=>{const{queue:a,playfield:o}=e,n=a[0],s=a.slice(1).concat(t.payload||[]),r=!C(n,o)&&!((e,t)=>e.shape.some(((a,o)=>a.some(((a,n)=>a&&t[o+e.top][n+e.left])))))(n,o);return{...e,tetromino:n,ghostPiece:M(n,o),phase:r?y:b,sfx:r?"spawn":"gameOver",queue:s,alive:r}},hardDrop:e=>{const{tetromino:t,playfield:a}=e,o=M(t,a);return{...e,tetromino:o,sfx:"hardDrop",phase:g}},start:(e,t)=>({playfield:I,queue:t.payload,phase:w,tetromino:void 0,alive:!0,interval:1e3,lines:0,countdown:3,originalPhase:void 0}),countdown:e=>({...e,countdown:Math.max(0,e.countdown-1)}),pause:e=>({...e,phase:O,originalPhase:e.phase}),resume:e=>({...e,phase:k,countdown:3}),restore:e=>({...e,phase:e.originalPhase,originalPhase:void 0})},J={tick:[y],move:[y,g],lock:[g],clear:[j],rotateLeft:[y,g],rotateRight:[y,g],spawn:[v,w],hardDrop:[y],start:[x,b],countdown:[w,k],pause:[y,g,j,v],resume:[O],restore:[k]},U=(e,t)=>{var a;return(null===(a=J[t.type])||void 0===a?void 0:a.includes(e.phase))?B[t.type](e,t):e},z={playfield:I,queue:[],phase:x,tetromino:void 0,alive:!1,interval:1e3,lines:0,countdown:0},X={ArrowLeft:{type:"move",payload:P},ArrowRight:{type:"move",payload:E},ArrowDown:{type:"move",payload:L},ArrowUp:{type:"rotateRight"},x:{type:"rotateRight"}," ":{type:"hardDrop"},Escape:{type:"pause"},F1:{type:"pause"},z:{type:"rotateLeft"},Control:{type:"rotateLeft"}},Y=void 0,Z="O",G={top:0,left:4,name:Z,shape:[[Z,Z],[Z,Z]]},H="I",K={top:0,left:3,name:H,shape:[[Y,Y,Y,Y],[H,H,H,H],[Y,Y,Y,Y],[Y,Y,Y,Y]]},Q="S",V={top:0,left:3,name:Q,shape:[[Y,Q,Q],[Q,Q,Y],[Y,Y,Y]]},W="Z",$={top:0,left:3,name:W,shape:[[W,W,Y],[Y,W,W],[Y,Y,Y]]},_="T",ee={top:0,left:3,name:_,shape:[[Y,_,Y],[_,_,_],[Y,Y,Y]]},te="J",ae={top:0,left:3,name:te,shape:[[te,Y,Y],[te,te,te],[Y,Y,Y]]},oe="L",ne={top:0,left:3,name:oe,shape:[[Y,Y,oe],[oe,oe,oe],[Y,Y,Y]]},se=(e=>{const t=new e,a=e=>{const a=(e=>fetch(e).then((e=>e.arrayBuffer())).then((e=>t.decodeAudioData(e))))(e);return()=>a.then((e=>{const a=t.createBufferSource();a.buffer=e,a.connect(t.destination),a.start()}))};return{clear1:a(c),clear2:a(i),clear3:a(p),clear4:a(d),locked:a(u),spawn:a(f),hardDrop:a(m),gameOver:a(h)}})(AudioContext);var re,le;var ce=N((re=se,le=()=>(e=>{const t=e.slice(0);let a=t.slice(0).length-1;for(;a>=0;){const e=Math.floor(Math.random()*(a+1)),o=t[a];t[a]=t[e],t[e]=o,a-=1}return t})([K,G,ee,V,$,ae,ne]),()=>{const[e,t]=Object(n.useReducer)(U,z),a=e.alive&&void 0!==e.tetromino&&e.phase!==O;return Object(n.useEffect)((()=>{const o=a?setInterval((()=>t({type:"tick"})),e.interval):0;return()=>clearInterval(o)}),[a,e.interval]),Object(n.useEffect)((()=>{e.sfx&&re[e.sfx]()}),[e.sfx]),Object(n.useEffect)((()=>{var a;const o={[v]:()=>setTimeout((()=>t({type:"spawn",payload:e.queue.length<=3?le():[]})),500),[g]:()=>setTimeout((()=>t({type:"lock"})),500),[j]:()=>setTimeout((()=>t({type:"clear"})),500),[w]:()=>{e.countdown>0?setTimeout((()=>t({type:"countdown"})),1e3):t({type:"spawn",payload:le()})},[k]:()=>{e.countdown>0?setTimeout((()=>t({type:"countdown"})),1e3):t({type:"restore"})}};null===(a=o[e.phase])||void 0===a||a.call(o)}),[e.phase,e.queue.length,e.countdown]),Object(n.useEffect)((()=>{const a=e=>{X[e.key]&&(t(X[e.key]),e.preventDefault())};return e.alive&&document.body.addEventListener("keydown",a),()=>document.body.removeEventListener("keydown",a)}),[e.alive]),{state:e,start:()=>t({type:"start",payload:le()}),resume:()=>t({type:"resume"})}}));var ie=()=>Object(o.jsx)(ce,{});var pe=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,12)).then((({getCLS:t,getFID:a,getFCP:o,getLCP:n,getTTFB:s})=>{t(e),a(e),o(e),n(e),s(e)}))};l.a.render(Object(o.jsx)(s.a.StrictMode,{children:Object(o.jsx)(ie,{})}),document.getElementById("root")),pe()},9:function(e,t,a){}},[[11,1,2]]]);
//# sourceMappingURL=main.7ea34e84.chunk.js.map