(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r,a,c,o=n(1),i=n(2),u=n.n(i),l=n(8),f=n.n(l),s=(n(15),n(16),n.p+"static/media/clear1.fe1236db.mp3"),p=n.p+"static/media/clear2.42d27630.mp3",d=n.p+"static/media/clear3.50cd846e.mp3",h=n.p+"static/media/clear4.529df8a4.mp3",m=n.p+"static/media/gameOver.f52cf5f0.mp3",j=n.p+"static/media/hardDrop.d2d4cb32.mp3",v=n.p+"static/media/locked.f92eb651.mp3",b=n.p+"static/media/spawn.dcb5ecc2.mp3",O=function(e){return function(){var t=e().state,n=function(e,t,n){var r;return e&&(null===(r=e.shape[n-e.top])||void 0===r?void 0:r[t-e.left])};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("div",{className:"frame",children:Object(o.jsx)("div",{"data-testid":"playfield",className:"playfield",children:t.playfield.map((function(e,r){return Object(o.jsx)("div",{className:"row"+("clearing"===t.phase&&e.every((function(e){return e}))?" clearing":""),children:e.map((function(e,a){return Object(o.jsx)("div",{className:n(t.tetromino,a,r)||(n(t.ghostPiece,a,r)?"ghost-piece":"")||e||""},a)}))},r)}))})}),Object(o.jsxs)("div",{className:"frame",children:[Object(o.jsx)("h1",{children:"NEXT"}),Object(o.jsx)("div",{className:"next-tetrominoes",children:t.queue.slice(0,3).map((function(e,t){return Object(o.jsx)("div",{className:"next-tetromino",children:e.shape.map((function(e,t){return Object(o.jsx)("div",{className:"row",children:e.map((function(e,t){return Object(o.jsx)("div",{className:e},t)}))},t)}))},t)}))}),Object(o.jsx)("h1",{children:"LINES"}),Object(o.jsx)("div",{className:"lines",children:t.lines})]})]})}},y=n(3),g=n(9),x=n(4),k=n(0),w=function(e,t){var n=t.length;return e.shape.some((function(r,a){return r.some((function(r,c){return r&&(a+e.top>=n-1||t[a+e.top+1][c+e.left])}))}))},N=function(e,t,n){return function(e,t){var n=t[0].length,r=t.length;return!e.shape.some((function(a,c){return a.some((function(a,o){return a&&(o+e.left<0||o+e.left>=n||c+e.top>=r||t[c+e.top][o+e.left])}))}))}(e,n)?e:t},A=function(e,t){return N(Object(k.a)(Object(k.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,r){return e.shape[e.shape.length-1-r][n]}))}))}),e,t)},D=37,E=39,L=40,P=(r={},Object(y.a)(r,D,{left:-1,top:0}),Object(y.a)(r,E,{left:1,top:0}),Object(y.a)(r,L,{left:0,top:1}),r),C=function(e,t,n){return N(Object(k.a)(Object(k.a)({},e),{},{left:e.left+P[n].left,top:e.top+P[n].top}),e,t)},T=function(e,t){return t.map((function(t,n){return t.map((function(t,r){var a;return t||(null===(a=e.shape[n-e.top])||void 0===a?void 0:a[r-e.left])}))}))},q=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.top,a=Object(k.a)(Object(k.a)({},t),{},{top:r});return w(a,n)?a:e(t,n,r+1)},I=function(e,t){return Object(x.a)(Array(t)).map((function(){return Object(x.a)(Array(e)).map((function(){}))}))},R="spawning",F="descending",M="locking",S="clearing",B="gameOver",J=function(e){var t=function(e,t){var n=w(e,t);return{playfield:n?T(e,t):t,locked:n}}(e.tetromino,e.playfield);return t.locked?Object(k.a)(Object(k.a)({},e),{},{tetromino:void 0,ghostPiece:void 0,playfield:t.playfield,sfx:"locked",phase:S}):Object(k.a)(Object(k.a)({},e),{},{phase:F})},U={tick:function(e){var t=e.tetromino,n=e.playfield,r=C(t,n,L);return Object(k.a)(Object(k.a)({},e),{},{tetromino:r,phase:w(r,n)?M:F})},move:function(e,t){var n=e.tetromino,r=e.playfield,a=C(n,r,t.payload);return e.phase===M&&t.payload===L?J(e):Object(k.a)(Object(k.a)({},e),{},{tetromino:a,ghostPiece:q(a,r),phase:w(a,r)?M:F})},lock:J,clear:function(e){var t=function(e){var t=e[0].length,n=e.reduceRight((function(e,t){return t.every((function(e){return e}))?e:[t].concat(e)}),[]),r=e.length-n.length;return{playfield:I(t,r).concat(n),linesCleared:r}}(e.playfield),n=e.lines+t.linesCleared;return Object(k.a)(Object(k.a)({},e),{},{playfield:t.playfield,lines:n,sfx:t.linesCleared>0?"clear"+t.linesCleared:void 0,interval:Math.max(100,1e3-100*Math.floor(n/10)),phase:R})},rotateRight:function(e){var t=e.tetromino,n=e.playfield,r=A(t,n);return Object(k.a)(Object(k.a)({},e),{},{tetromino:A(t,n),ghostPiece:q(r,n)})},rotateLeft:function(e){var t=e.tetromino,n=e.playfield,r=function(e,t){return N(Object(k.a)(Object(k.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,r){return e.shape[r][e.shape.length-1-n]}))}))}),e,t)}(t,n);return Object(k.a)(Object(k.a)({},e),{},{tetromino:r,ghostPiece:q(r,n)})},spawn:function(e,t){var n=e.queue,r=e.playfield,a=n[0],c=n.slice(1).concat(t.payload||[]),o=function(e,t){return!e.shape.some((function(n,r){return n.some((function(n,a){return n&&t[r+e.top][a+e.left]}))}))}(a,r);return Object(k.a)(Object(k.a)({},e),{},{tetromino:a,ghostPiece:q(a,r),phase:o?F:B,sfx:o?"spawn":"gameOver",queue:c,alive:o})},hardDrop:function(e){var t=e.tetromino,n=e.playfield,r=q(t,n);return Object(k.a)(Object(k.a)({},e),{},{tetromino:r,sfx:"hardDrop",phase:M})}},X={tick:[F],move:[F,M],lock:[M],clear:[S],rotateLeft:[F,M],rotateRight:[F,M],spawn:[R],hardDrop:[F]},Z=function(e,t){var n;return(null===(n=X[t.type])||void 0===n?void 0:n.includes(e.phase))?U[t.type](e,t):e},z={ArrowLeft:D,ArrowRight:E,ArrowDown:L},G=void 0,H="O",K="I",Q="S",V="Z",W="T",Y="J",$="L",_=[{top:0,left:3,name:K,shape:[[G,G,G,G],[K,K,K,K],[G,G,G,G],[G,G,G,G]]},{top:0,left:4,name:H,shape:[[H,H],[H,H]]},{top:0,left:3,name:W,shape:[[G,W,G],[W,W,W],[G,G,G]]},{top:0,left:3,name:Q,shape:[[G,Q,Q],[Q,Q,G],[G,G,G]]},{top:0,left:3,name:V,shape:[[V,V,G],[G,V,V],[G,G,G]]},{top:0,left:3,name:Y,shape:[[Y,G,G],[Y,Y,Y],[G,G,G]]},{top:0,left:3,name:$,shape:[[G,G,$],[$,$,$],[G,G,G]]}],ee=function(e){var t=new e,n=function(e){var n=function(e){return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return t.decodeAudioData(e)}))}(e);return function(){return n.then((function(e){var n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start()}))}};return{clear1:n(s),clear2:n(p),clear3:n(d),clear4:n(h),locked:n(v),spawn:n(b),hardDrop:n(j),gameOver:n(m)}}(AudioContext),te=O((a=ee,c=function(){return function(e){for(var t=e.slice(0),n=t.slice(0).length-1;n>=0;){var r=Math.floor(Math.random()*(n+1)),a=t[n];t[n]=t[r],t[r]=a,n-=1}return t}(_)},function(){var e=c(),t=e[0],n=Object(x.a)(Array(20)).map((function(){return Object(x.a)(Array(10)).map((function(){}))})),r=Object(i.useReducer)(Z,{playfield:n,queue:e.slice(1),phase:F,tetromino:t,alive:!0,score:0,lines:0,interval:1e3,ghostPiece:q(t,n)}),o=Object(g.a)(r,2),u=o[0],l=o[1];return Object(i.useEffect)((function(){var e=u.alive?setInterval((function(){return l({type:"tick"})}),u.interval):0;return function(){return clearInterval(e)}}),[u.alive,u.interval]),Object(i.useEffect)((function(){u.sfx&&a[u.sfx]()}),[u.sfx]),Object(i.useEffect)((function(){var e,t,n=(e={},Object(y.a)(e,R,(function(){return setTimeout((function(){return l({type:"spawn",payload:u.queue.length<=3?c():[]})}),500)})),Object(y.a)(e,M,(function(){return setTimeout((function(){return l({type:"lock"})}),500)})),Object(y.a)(e,S,(function(){return setTimeout((function(){return l({type:"clear"})}),500)})),e);null===(t=n[u.phase])||void 0===t||t.call(n)}),[u.phase,u.queue.length]),Object(i.useEffect)((function(){var e=function(e){z[e.key]&&l({type:"move",payload:z[e.key]}),"ArrowUp"===e.key&&l({type:"rotateRight"})," "===e.key&&l({type:"hardDrop"})};return u.alive&&document.body.addEventListener("keydown",e),function(){return document.body.removeEventListener("keydown",e)}}),[u.alive]),{state:u}})),ne=function(){return Object(o.jsx)(te,{})},re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,18)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))};f.a.render(Object(o.jsx)(u.a.StrictMode,{children:Object(o.jsx)(ne,{})}),document.getElementById("root")),re()}},[[17,1,2]]]);
//# sourceMappingURL=main.7bd12b30.chunk.js.map