(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{10:function(e,t,a){},11:function(e,t,a){"use strict";a.r(t);var o=a(0),n=a(1),s=a.n(n),r=a(3),l=a.n(r);a(9),a(10);const c="spawning",i="descending",d="locking",p="clearing",h="gameOver",m="starting",u="pending",f="paused",v="resuming";var y=e=>()=>{var t;const{state:a,start:n,resume:s}=e(),r=(e,t,a)=>{var o;return e&&(null===(o=e.shape[a-e.top])||void 0===o?void 0:o[t-e.left])};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("aside",{className:"frame",children:Object(o.jsxs)("section",{children:[Object(o.jsx)("h1",{children:"HOLD"}),Object(o.jsx)("div",{className:"frame-content hold",children:Object(o.jsx)("div",{className:"small-tetromino",children:null===(t=a.hold)||void 0===t?void 0:t.shape.map(((e,t)=>Object(o.jsx)("div",{className:"row",children:e.map(((e,t)=>Object(o.jsx)("div",{className:e},t)))},t)))})})]})}),Object(o.jsxs)("main",{className:"frame",children:[Object(o.jsx)("div",{"data-testid":"playfield",className:"playfield frame-content",children:a.playfield.map(((e,t)=>Object(o.jsx)("div",{className:"row"+("clearing"===a.phase&&e.every((e=>e))?" clearing":""),children:e.map(((e,n)=>Object(o.jsx)("div",{className:r(a.tetromino,n,t)||(r(a.ghostPiece,n,t)?"ghost-piece":"")||e||""},n)))},t)))}),a.phase===u||a.phase===h?Object(o.jsx)("div",{className:"controls",children:Object(o.jsx)("button",{onClick:n,children:"START"})}):null,a.phase===f?Object(o.jsx)("div",{className:"controls",children:Object(o.jsx)("button",{onClick:s,children:"RESUME"})}):null,a.countdown>0?Object(o.jsx)("div",{className:"countdown",children:a.countdown}):null]}),Object(o.jsxs)("aside",{className:"frame",children:[Object(o.jsxs)("section",{children:[Object(o.jsx)("h1",{children:"NEXT"}),Object(o.jsx)("div",{className:"frame-content next-tetrominos",children:a.queue.slice(0,3).map(((e,t)=>Object(o.jsx)("div",{className:"small-tetromino",children:e.shape.map(((e,t)=>Object(o.jsx)("div",{className:"row",children:e.map(((e,t)=>Object(o.jsx)("div",{className:e},t)))},t)))},t)))})]}),Object(o.jsxs)("section",{children:[Object(o.jsx)("h1",{children:"LINES"}),Object(o.jsx)("div",{className:"frame-content lines",children:a.lines})]})]})]})},j=a.p+"static/media/clear1.fe1236db.mp3",b=a.p+"static/media/clear2.42d27630.mp3",g=a.p+"static/media/clear3.50cd846e.mp3",O=a.p+"static/media/clear4.529df8a4.mp3",x=a.p+"static/media/gameOver.f52cf5f0.mp3",w=a.p+"static/media/hardDrop.d2d4cb32.mp3",k=a.p+"static/media/locked.f92eb651.mp3",P=a.p+"static/media/spawn.dcb5ecc2.mp3";const L=(e,t)=>{const a=t.length;return e.shape.some(((o,n)=>o.some(((o,s)=>o&&(n+e.top>=a-1||t[n+e.top+1][s+e.left])))))},N=(e,t)=>{const a=t[0].length,o=t.length;return e.shape.some(((n,s)=>n.some(((n,r)=>n&&(r+e.left<0||r+e.left>=a||s+e.top>=o||t[s+e.top][r+e.left])))))},E=[[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]],[[0,0],[1,0],[1,1],[0,-2],[1,-2]],[[0,0],[1,0],[1,-1],[0,2],[1,2]],[[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]]],T=[E[2],E[1],E[0],E[3]],A=[[[0,0],[-2,0],[1,0],[-2,1],[1,-2]],[[0,0],[-1,0],[2,0],[-1,-2],[2,1]],[[0,0],[2,0],[-1,0],[2,-1],[-1,2]],[[0,0],[1,0],[-2,0],[1,2],[-2,-1]]],q=[[[0,0]],[[0,0]],[[0,0]],[[0,0]]],C={I:[A[1],A[2],A[3],A[0]],O:q,L:T,J:T,Z:T,S:T,T:T},D={I:A,O:q,L:E,J:E,Z:E,S:E,T:E},I=37,R=39,S=40,M={[I]:{left:-1,top:0},[R]:{left:1,top:0},[S]:{left:0,top:1}},F=(e,t,a,o=0)=>{const n={...e,left:e.left+a[o][0],top:e.top+a[o][1]};return N(n,t)?o===a.length-1?null:F(e,t,a,o+1):n},J=(e,t,a,o)=>{var n;return null!==(n=F(e,a,o))&&void 0!==n?n:t},B=(e,t)=>J({...e,rotationPhase:(e.rotationPhase+1)%4,shape:e.shape.map(((t,a)=>t.map(((t,o)=>e.shape[e.shape.length-1-o][a]))))},e,t,D[e.name][e.rotationPhase]),Z=(e,t,a)=>((e,t,a)=>N(e,a)?t:e)({...e,left:e.left+M[a].left,top:e.top+M[a].top},e,t),U=(e,t)=>t.map(((t,a)=>t.map(((t,o)=>{var n;return t||(null===(n=e.shape[a-e.top])||void 0===n?void 0:n[o-e.left])})))),z=(e,t,a=e.top)=>{const o={...e,top:a};return L(o,t)?o:z(e,t,a+1)},H=(e,t)=>[...Array(t)].map((()=>[...Array(e)].map((()=>{})))),X=void 0,G="O",K={top:0,left:4,name:G,rotationPhase:0,shape:[[G,G],[G,G]]},Q="I",V={top:0,left:3,name:Q,rotationPhase:0,shape:[[X,X,X,X],[Q,Q,Q,Q],[X,X,X,X],[X,X,X,X]]},W="S",Y={top:0,left:3,name:W,rotationPhase:0,shape:[[X,W,W],[W,W,X],[X,X,X]]},$="Z",_={top:0,left:3,name:$,rotationPhase:0,shape:[[$,$,X],[X,$,$],[X,X,X]]},ee="T",te={top:0,left:3,name:ee,rotationPhase:0,shape:[[X,ee,X],[ee,ee,ee],[X,X,X]]},ae="J",oe={top:0,left:3,name:ae,rotationPhase:0,shape:[[ae,X,X],[ae,ae,ae],[X,X,X]]},ne="L",se={top:0,left:3,name:ne,rotationPhase:0,shape:[[X,X,ne],[ne,ne,ne],[X,X,X]]},re={O:K,L:se,J:oe,Z:_,I:V,T:te,S:Y},le=[...Array(22)].map((()=>[...Array(10)].map((()=>{})))),ce=e=>{const{tetromino:t,playfield:a}=e,o=((e,t)=>{const a=L(e,t);return{playfield:a?U(e,t):t,locked:a}})(t,a);return o.locked?{...e,tetromino:void 0,ghostPiece:void 0,playfield:o.playfield,sfx:"locked",phase:p}:{...e,phase:i}},ie={tick:e=>{const{tetromino:t,playfield:a}=e,o=Z(t,a,S);return{...e,tetromino:o,phase:L(o,a)?d:e.phase}},move:(e,t)=>{const{tetromino:a,playfield:o}=e,n=Z(a,o,t.payload);return e.phase===d&&t.payload===S?ce(e):{...e,tetromino:n,ghostPiece:z(n,o),phase:L(n,o)?d:i}},lock:ce,clear:e=>{const{playfield:t}=e,a=(e=>{const t=e[0].length,a=e.reduceRight(((e,t)=>t.every((e=>e))?e:[t].concat(e)),[]),o=e.length-a.length;return{playfield:H(t,o).concat(a),linesCleared:o}})(t),o=e.lines+a.linesCleared;return{...e,playfield:a.playfield,lines:o,sfx:a.linesCleared>0?"clear"+a.linesCleared:void 0,interval:Math.max(100,1e3-100*Math.floor(o/10)),phase:c}},rotateRight:e=>{const{tetromino:t,playfield:a}=e,o=B(t,a);return{...e,tetromino:B(t,a),ghostPiece:z(o,a)}},rotateLeft:e=>{const{tetromino:t,playfield:a}=e,o=((e,t)=>J({...e,rotationPhase:(e.rotationPhase+3)%4,shape:e.shape.map(((t,a)=>t.map(((t,o)=>e.shape[o][e.shape.length-1-a]))))},e,t,C[e.name][e.rotationPhase]))(t,a);return{...e,tetromino:o,ghostPiece:z(o,a)}},spawn:(e,t)=>{const{queue:a,playfield:o}=e,n=a[0],s=a.slice(1).concat(t.payload||[]),r=!L(n,o)&&!N(n,o);return{...e,tetromino:n,ghostPiece:z(n,o),phase:r?i:h,sfx:r?"spawn":"gameOver",queue:s,holdLock:!1,alive:r}},hardDrop:e=>{const{tetromino:t,playfield:a}=e,o=z(t,a);return ce({...e,tetromino:o,phase:d})},start:(e,t)=>({playfield:le,queue:t.payload,phase:m,tetromino:void 0,alive:!0,interval:1e3,lines:0,countdown:3,originalPhase:void 0}),countdown:e=>({...e,countdown:Math.max(0,e.countdown-1)}),pause:e=>({...e,phase:f,originalPhase:e.phase}),resume:e=>({...e,phase:v,countdown:3}),restore:e=>({...e,phase:e.originalPhase,originalPhase:void 0}),hold:e=>{var t;const a=null!==(t=e.hold)&&void 0!==t?t:e.queue[0];return e.holdLock?e:{...e,hold:re[e.tetromino.name],holdLock:!0,tetromino:a,queue:e.hold?e.queue:e.queue.slice(1),ghostPiece:z(a,e.playfield)}}},de={tick:[i],move:[i,d],lock:[d],clear:[p],rotateLeft:[i,d],rotateRight:[i,d],spawn:[c,m],hardDrop:[i],start:[u,h],countdown:[m,v],pause:[i,d,p,c],resume:[f],restore:[v],hold:[i]},pe=(e,t)=>{var a;return(null===(a=de[t.type])||void 0===a?void 0:a.includes(e.phase))?ie[t.type](e,t):e},he={playfield:le,queue:[],phase:u,tetromino:void 0,alive:!1,interval:1e3,lines:0,countdown:0},me=e=>t=>t(e),ue=(e,t,a)=>(o,n)=>{if(n.repeat)return;o(e);const s=setTimeout((()=>{const n=setInterval((()=>{o(e)}),t),s=e=>{e.key===a&&(clearInterval(n),document.body.removeEventListener("keyup",s))};document.body.addEventListener("keyup",s)}),200-t),r=e=>{e.key===a&&(clearTimeout(s),document.body.removeEventListener("keyup",r))};document.body.addEventListener("keyup",r)},fe={ArrowLeft:ue({type:"move",payload:I},50,"ArrowLeft"),ArrowRight:ue({type:"move",payload:R},50,"ArrowRight"),ArrowDown:ue({type:"move",payload:S},33,"ArrowDown"),ArrowUp:me({type:"rotateRight"}),x:me({type:"rotateRight"})," ":me({type:"hardDrop"}),Escape:me({type:"pause"}),F1:me({type:"pause"}),z:me({type:"rotateLeft"}),Control:me({type:"rotateLeft"}),c:me({type:"hold"})},ve=(e=>{const t=new e,a=e=>{const a=(e=>fetch(e).then((e=>e.arrayBuffer())).then((e=>t.decodeAudioData(e))))(e);return()=>a.then((e=>{const a=t.createBufferSource();a.buffer=e,a.connect(t.destination),a.start()}))};return{clear1:a(j),clear2:a(b),clear3:a(g),clear4:a(O),locked:a(k),spawn:a(P),hardDrop:a(w),gameOver:a(x)}})(AudioContext);var ye,je;var be=y((ye=ve,je=()=>(e=>{const t=e.slice(0);let a=t.slice(0).length-1;for(;a>=0;){const e=Math.floor(Math.random()*(a+1)),o=t[a];t[a]=t[e],t[e]=o,a-=1}return t})([V,K,te,Y,_,oe,se]),()=>{const[e,t]=Object(n.useReducer)(pe,he),a=e.alive&&void 0!==e.tetromino&&e.phase!==f;return Object(n.useEffect)((()=>{const o=a?setInterval((()=>t({type:"tick"})),e.interval):0;return()=>clearInterval(o)}),[a,e.interval]),Object(n.useEffect)((()=>{e.sfx&&ye[e.sfx]()}),[e.sfx]),Object(n.useEffect)((()=>{var a;const o={[c]:()=>t({type:"spawn",payload:e.queue.length<=3?je():[]}),[d]:()=>setTimeout((()=>t({type:"lock"})),500),[p]:()=>setTimeout((()=>t({type:"clear"})),500),[m]:()=>{e.countdown>0?setTimeout((()=>t({type:"countdown"})),1e3):t({type:"spawn",payload:je()})},[v]:()=>{e.countdown>0?setTimeout((()=>t({type:"countdown"})),1e3):t({type:"restore"})}};null===(a=o[e.phase])||void 0===a||a.call(o)}),[e.phase,e.queue.length,e.countdown]),Object(n.useEffect)((()=>{const a=e=>{fe[e.key]&&(fe[e.key](t,e),e.preventDefault())};return e.alive&&document.body.addEventListener("keydown",a),()=>document.body.removeEventListener("keydown",a)}),[e.alive]),{state:e,start:()=>t({type:"start",payload:je()}),resume:()=>t({type:"resume"})}}));var ge=()=>Object(o.jsx)(be,{});var Oe=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,12)).then((({getCLS:t,getFID:a,getFCP:o,getLCP:n,getTTFB:s})=>{t(e),a(e),o(e),n(e),s(e)}))};l.a.render(Object(o.jsx)(s.a.StrictMode,{children:Object(o.jsx)(ge,{})}),document.getElementById("root")),Oe()},9:function(e,t,a){}},[[11,1,2]]]);
//# sourceMappingURL=main.11b4cf4f.chunk.js.map