(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r,a,c,i=n(1),o=n(2),u=n.n(o),l=n(8),f=n.n(l),s=(n(15),n(16),n.p+"static/media/clear1.fe1236db.mp3"),p=n.p+"static/media/clear2.42d27630.mp3",d=n.p+"static/media/clear3.50cd846e.mp3",m=n.p+"static/media/clear4.529df8a4.mp3",h=n.p+"static/media/gameOver.f52cf5f0.mp3",v=n.p+"static/media/locked.f92eb651.mp3",j=n.p+"static/media/spawn.dcb5ecc2.mp3",b=function(e){return function(){var t=e().state,n=function(e,t,n){var r;return e&&(null===(r=e.shape[n-e.top])||void 0===r?void 0:r[t-e.left])};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"frame",children:Object(i.jsx)("div",{"data-testid":"playfield",className:"playfield",children:t.playfield.map((function(e,r){return Object(i.jsx)("div",{className:"row"+("clearing"===t.phase&&e.every((function(e){return e}))?" clearing":""),children:e.map((function(e,a){return Object(i.jsx)("div",{className:n(t.tetromino,a,r)||(n(t.ghostPiece,a,r)?"ghost-piece":"")||e||""},a)}))},r)}))})}),Object(i.jsxs)("div",{className:"frame",children:[Object(i.jsx)("h1",{children:"NEXT"}),Object(i.jsx)("div",{className:"next-tetrominoes",children:t.queue.slice(0,3).map((function(e,t){return Object(i.jsx)("div",{className:"next-tetromino",children:e.shape.map((function(e,t){return Object(i.jsx)("div",{className:"row",children:e.map((function(e,t){return Object(i.jsx)("div",{className:e},t)}))},t)}))},t)}))}),Object(i.jsx)("h1",{children:"LINES"}),Object(i.jsx)("div",{className:"lines",children:t.lines})]})]})}},O=n(3),y=n(9),g=n(4),x=n(0),k=function(e,t){var n=t.length;return e.shape.some((function(r,a){return r.some((function(r,c){return r&&(a+e.top>=n-1||t[a+e.top+1][c+e.left])}))}))},w=function(e,t,n){return function(e,t){var n=t[0].length,r=t.length;return!e.shape.some((function(a,c){return a.some((function(a,i){return a&&(i+e.left<0||i+e.left>=n||c+e.top>=r||t[c+e.top][i+e.left])}))}))}(e,n)?e:t},N=function(e,t){return w(Object(x.a)(Object(x.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,r){return e.shape[e.shape.length-1-r][n]}))}))}),e,t)},A=37,E=39,L=40,P=(r={},Object(O.a)(r,A,{left:-1,top:0}),Object(O.a)(r,E,{left:1,top:0}),Object(O.a)(r,L,{left:0,top:1}),r),C=function(e,t,n){return w(Object(x.a)(Object(x.a)({},e),{},{left:e.left+P[n].left,top:e.top+P[n].top}),e,t)},T=function(e,t){return t.map((function(t,n){return t.map((function(t,r){var a;return t||(null===(a=e.shape[n-e.top])||void 0===a?void 0:a[r-e.left])}))}))},q=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.top,a=Object(x.a)(Object(x.a)({},t),{},{top:r});return k(a,n)?a:e(t,n,r+1)},I=function(e,t){return Object(g.a)(Array(t)).map((function(){return Object(g.a)(Array(e)).map((function(){}))}))},R="spawning",F="descending",M="locking",S="clearing",B="gameOver",D=function(e){var t=function(e,t){var n=k(e,t);return{playfield:n?T(e,t):t,locked:n}}(e.tetromino,e.playfield);return t.locked?Object(x.a)(Object(x.a)({},e),{},{tetromino:void 0,ghostPiece:void 0,playfield:t.playfield,sfx:"locked",phase:S}):Object(x.a)(Object(x.a)({},e),{},{phase:F})},J={tick:function(e){var t=e.tetromino,n=e.playfield,r=C(t,n,L);return Object(x.a)(Object(x.a)({},e),{},{tetromino:r,phase:k(r,n)?M:F})},move:function(e,t){var n=e.tetromino,r=e.playfield,a=C(n,r,t.payload);return e.phase===M&&t.payload===L?D(e):Object(x.a)(Object(x.a)({},e),{},{tetromino:a,ghostPiece:q(a,r),phase:k(a,r)?M:F})},lock:D,clear:function(e){var t=function(e){var t=e[0].length,n=e.reduceRight((function(e,t){return t.every((function(e){return e}))?e:[t].concat(e)}),[]),r=e.length-n.length;return{playfield:I(t,r).concat(n),linesCleared:r}}(e.playfield),n=e.lines+t.linesCleared;return Object(x.a)(Object(x.a)({},e),{},{playfield:t.playfield,lines:n,sfx:t.linesCleared>0?"clear"+t.linesCleared:void 0,interval:Math.max(100,1e3-100*Math.floor(n/10)),phase:R})},rotateRight:function(e){var t=e.tetromino,n=e.playfield,r=N(t,n);return Object(x.a)(Object(x.a)({},e),{},{tetromino:N(t,n),ghostPiece:q(r,n)})},rotateLeft:function(e){var t=e.tetromino,n=e.playfield,r=function(e,t){return w(Object(x.a)(Object(x.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,r){return e.shape[r][e.shape.length-1-n]}))}))}),e,t)}(t,n);return Object(x.a)(Object(x.a)({},e),{},{tetromino:r,ghostPiece:q(r,n)})},spawn:function(e,t){var n=e.queue,r=e.playfield,a=n[0],c=n.slice(1).concat(t.payload||[]),i=function(e,t){return!e.shape.some((function(n,r){return n.some((function(n,a){return n&&t[r+e.top][a+e.left]}))}))}(a,r);return Object(x.a)(Object(x.a)({},e),{},{tetromino:a,ghostPiece:q(a,r),phase:i?F:B,sfx:i?"spawn":"gameOver",queue:c,alive:i})}},U={tick:[F],move:[F,M],lock:[M],clear:[S],rotateLeft:[F,M],rotateRight:[F,M],spawn:[R]},X=function(e,t){var n;return(null===(n=U[t.type])||void 0===n?void 0:n.includes(e.phase))?J[t.type](e,t):e},Z={ArrowLeft:A,ArrowRight:E,ArrowDown:L},z=void 0,G="O",H="I",K="S",Q="Z",V="T",W="J",Y="L",$=[{top:0,left:3,name:H,shape:[[z,z,z,z],[H,H,H,H],[z,z,z,z],[z,z,z,z]]},{top:0,left:4,name:G,shape:[[G,G],[G,G]]},{top:0,left:3,name:V,shape:[[z,V,z],[V,V,V],[z,z,z]]},{top:0,left:3,name:K,shape:[[z,K,K],[K,K,z],[z,z,z]]},{top:0,left:3,name:Q,shape:[[Q,Q,z],[z,Q,Q],[z,z,z]]},{top:0,left:3,name:W,shape:[[W,z,z],[W,W,W],[z,z,z]]},{top:0,left:3,name:Y,shape:[[z,z,Y],[Y,Y,Y],[z,z,z]]}],_=function(e){var t=new e,n=function(e){var n=function(e){return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return t.decodeAudioData(e)}))}(e);return function(){return n.then((function(e){var n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start()}))}};return{clear1:n(s),clear2:n(p),clear3:n(d),clear4:n(m),locked:n(v),spawn:n(j),gameOver:n(h)}}(AudioContext),ee=b((a=_,c=function(){return function(e){for(var t=e.slice(0),n=t.slice(0).length-1;n>=0;){var r=Math.floor(Math.random()*(n+1)),a=t[n];t[n]=t[r],t[r]=a,n-=1}return t}($)},function(){var e=c(),t=e[0],n=Object(g.a)(Array(20)).map((function(){return Object(g.a)(Array(10)).map((function(){}))})),r=Object(o.useReducer)(X,{playfield:n,queue:e.slice(1),phase:F,tetromino:t,alive:!0,score:0,lines:0,interval:1e3,ghostPiece:q(t,n)}),i=Object(y.a)(r,2),u=i[0],l=i[1];return Object(o.useEffect)((function(){var e=u.alive?setInterval((function(){return l({type:"tick"})}),u.interval):0;return function(){return clearInterval(e)}}),[u.alive,u.interval]),Object(o.useEffect)((function(){u.sfx&&a[u.sfx]()}),[u.sfx]),Object(o.useEffect)((function(){var e,t,n=(e={},Object(O.a)(e,R,(function(){return setTimeout((function(){return l({type:"spawn",payload:u.queue.length<=3?c():[]})}),500)})),Object(O.a)(e,M,(function(){return setTimeout((function(){return l({type:"lock"})}),500)})),Object(O.a)(e,S,(function(){return setTimeout((function(){return l({type:"clear"})}),500)})),e);null===(t=n[u.phase])||void 0===t||t.call(n)}),[u.phase,u.queue.length]),Object(o.useEffect)((function(){var e=function(e){Z[e.key]&&l({type:"move",payload:Z[e.key]}),"ArrowUp"===e.key&&l({type:"rotateRight"})};return u.alive&&document.body.addEventListener("keydown",e),function(){return document.body.removeEventListener("keydown",e)}}),[u.alive]),{state:u}})),te=function(){return Object(i.jsx)(ee,{})},ne=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,18)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};f.a.render(Object(i.jsx)(u.a.StrictMode,{children:Object(i.jsx)(te,{})}),document.getElementById("root")),ne()}},[[17,1,2]]]);
//# sourceMappingURL=main.96d0ff70.chunk.js.map