(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r,a,c,i=n(1),o=n(2),u=n.n(o),l=n(8),f=n.n(l),s=(n(15),n(16),n.p+"static/media/clear1.fe1236db.mp3"),p=n.p+"static/media/clear2.42d27630.mp3",d=n.p+"static/media/clear3.50cd846e.mp3",m=n.p+"static/media/clear4.529df8a4.mp3",h=n.p+"static/media/gameOver.f52cf5f0.mp3",v=n.p+"static/media/locked.f92eb651.mp3",j=n.p+"static/media/spawn.dcb5ecc2.mp3",b=function(e){return function(){var t=e().state;return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("div",{className:"frame",children:Object(i.jsx)("div",{"data-testid":"playfield",className:"playfield",children:t.playfield.map((function(e,n){return Object(i.jsx)("div",{className:"row"+("clearing"===t.phase&&e.every((function(e){return e}))?" clearing":""),children:e.map((function(e,r){var a,c,o;return Object(i.jsx)("div",{className:(null===(a=t.tetromino)||void 0===a||null===(c=a.shape)||void 0===c||null===(o=c[n-t.tetromino.top])||void 0===o?void 0:o[r-t.tetromino.left])||e||""},r)}))},n)}))})}),Object(i.jsxs)("div",{className:"frame",children:[Object(i.jsx)("h1",{children:"NEXT"}),Object(i.jsx)("div",{className:"next-tetrominoes",children:t.queue.slice(0,3).map((function(e,t){return Object(i.jsx)("div",{className:"next-tetromino",children:e.shape.map((function(e,t){return Object(i.jsx)("div",{className:"row",children:e.map((function(e,t){return Object(i.jsx)("div",{className:e},t)}))},t)}))},t)}))}),Object(i.jsx)("h1",{children:"LINES"}),Object(i.jsx)("div",{className:"lines",children:t.lines})]})]})}},O=n(3),y=n(4),g=n(9),x=n(0),k=function(e,t){return t.map((function(t,n){return t.map((function(t,r){var a;return t||(null===(a=e.shape[n-e.top])||void 0===a?void 0:a[r-e.left])}))}))},w=function(e,t){var n=t.length;return e.shape.some((function(r,a){return r.some((function(r,c){return r&&(a+e.top>=n-1||t[a+e.top+1][c+e.left])}))}))},N=function(e,t,n){return function(e,t){var n=t[0].length,r=t.length;return!e.shape.some((function(a,c){return a.some((function(a,i){return a&&(i+e.left<0||i+e.left>=n||c+e.top>=r||t[c+e.top][i+e.left])}))}))}(e,n)?e:t},A=function(e,t){return N(Object(x.a)(Object(x.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,r){return e.shape[r][e.shape.length-1-n]}))}))}),e,t)},E=function(e,t){return N(Object(x.a)(Object(x.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,r){return e.shape[e.shape.length-1-r][n]}))}))}),e,t)},L=37,C=39,T=40,q=(r={},Object(O.a)(r,L,{left:-1,top:0}),Object(O.a)(r,C,{left:1,top:0}),Object(O.a)(r,T,{left:0,top:1}),r),I=function(e,t,n){return N(Object(x.a)(Object(x.a)({},e),{},{left:e.left+q[n].left,top:e.top+q[n].top}),e,t)},R=function(e,t){return Object(y.a)(Array(t)).map((function(){return Object(y.a)(Array(e)).map((function(){}))}))},F="spawning",M="descending",S="locking",B="clearing",D="gameOver",J=function(e){var t=function(e,t){var n=w(e,t);return{playfield:n?k(e,t):t,locked:n}}(e.tetromino,e.playfield);return t.locked?Object(x.a)(Object(x.a)({},e),{},{tetromino:void 0,playfield:t.playfield,sfx:"locked",phase:B}):Object(x.a)(Object(x.a)({},e),{},{phase:M})},P={tick:function(e){var t=e.tetromino,n=e.playfield,r=I(t,n,T);return Object(x.a)(Object(x.a)({},e),{},{tetromino:r,phase:w(r,n)?S:M})},move:function(e,t){var n=e.tetromino,r=e.playfield,a=I(n,r,t.payload);return e.phase===S&&t.payload===T?J(e):Object(x.a)(Object(x.a)({},e),{},{tetromino:a,phase:w(a,r)?S:M})},lock:J,clear:function(e){var t=function(e){var t=e[0].length,n=e.reduceRight((function(e,t){return t.every((function(e){return e}))?e:[t].concat(e)}),[]),r=e.length-n.length;return{playfield:R(t,r).concat(n),linesCleared:r}}(e.playfield),n=e.lines+t.linesCleared;return Object(x.a)(Object(x.a)({},e),{},{playfield:t.playfield,lines:n,sfx:t.linesCleared>0?"clear"+t.linesCleared:void 0,interval:Math.max(100,1e3-50*Math.floor(n/10)),phase:F})},rotateRight:function(e){var t=e.tetromino,n=e.playfield;return Object(x.a)(Object(x.a)({},e),{},{tetromino:E(t,n)})},rotateLeft:function(e){var t=e.tetromino,n=e.playfield;return Object(x.a)(Object(x.a)({},e),{},{tetromino:A(t,n)})},spawn:function(e,t){var n=e.queue,r=e.playfield,a=n[0],c=n.slice(1).concat(t.payload||[]),i=function(e,t){return!e.shape.some((function(n,r){return n.some((function(n,a){return n&&t[r+e.top][a+e.left]}))}))}(a,r);return Object(x.a)(Object(x.a)({},e),{},{tetromino:a,phase:i?M:D,sfx:i?"spawn":"gameOver",queue:c,alive:i})}},U={tick:[M,S],move:[M,S],lock:[S],clear:[B],rotateLeft:[M,S],rotateRight:[M,S],spawn:[F]},X=function(e,t){var n;return(null===(n=U[t.type])||void 0===n?void 0:n.includes(e.phase))?P[t.type](e,t):e},Z={ArrowLeft:L,ArrowRight:C,ArrowDown:T},z=void 0,G="O",H="I",K="S",Q="Z",V="T",W="J",Y="L",$=[{top:0,left:3,name:H,shape:[[z,z,z,z],[H,H,H,H],[z,z,z,z],[z,z,z,z]]},{top:0,left:4,name:G,shape:[[G,G],[G,G]]},{top:0,left:3,name:V,shape:[[z,V,z],[V,V,V],[z,z,z]]},{top:0,left:3,name:K,shape:[[z,K,K],[K,K,z],[z,z,z]]},{top:0,left:3,name:Q,shape:[[Q,Q,z],[z,Q,Q],[z,z,z]]},{top:0,left:3,name:W,shape:[[W,z,z],[W,W,W],[z,z,z]]},{top:0,left:3,name:Y,shape:[[z,z,Y],[Y,Y,Y],[z,z,z]]}],_=function(e){var t=new e,n=function(e){return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return t.decodeAudioData(e)}))},r=function(e){return function(){return e.then((function(e){var n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start()}))}},a=n(s),c=n(p),i=n(d),o=n(m),u=n(v),l=n(j),f=n(h);return{clear1:r(a),clear2:r(c),clear3:r(i),clear4:r(o),locked:r(u),spawn:r(l),gameOver:r(f)}}(AudioContext),ee=b((a=_,c=function(){return function(e){for(var t=e.slice(0),n=t.slice(0).length-1;n>=0;){var r=Math.floor(Math.random()*(n+1)),a=t[n];t[n]=t[r],t[r]=a,n-=1}return t}($)},function(){var e=c(),t=e[0],n=Object(o.useReducer)(X,{playfield:Object(y.a)(Array(20)).map((function(){return Object(y.a)(Array(10)).map((function(){}))})),queue:e.slice(1),phase:M,tetromino:t,alive:!0,score:0,lines:0,interval:1e3}),r=Object(g.a)(n,2),i=r[0],u=r[1];return Object(o.useEffect)((function(){var e=i.alive?setInterval((function(){return u({type:"tick"})}),i.interval):0;return function(){return clearInterval(e)}}),[i.alive,i.interval]),Object(o.useEffect)((function(){i.sfx&&a[i.sfx]()}),[i.sfx]),Object(o.useEffect)((function(){var e,t,n=(e={},Object(O.a)(e,F,(function(){return setTimeout((function(){return u({type:"spawn",payload:i.queue.length<=3?c():[]})}),500)})),Object(O.a)(e,S,(function(){return setTimeout((function(){return u({type:"lock"})}),500)})),Object(O.a)(e,B,(function(){return setTimeout((function(){return u({type:"clear"})}),500)})),e);null===(t=n[i.phase])||void 0===t||t.call(n)}),[i.phase,i.queue.length]),Object(o.useEffect)((function(){var e=function(e){Z[e.key]&&u({type:"move",payload:Z[e.key]}),"ArrowUp"===e.key&&u({type:"rotateRight"})};return i.alive&&document.body.addEventListener("keydown",e),function(){return document.body.removeEventListener("keydown",e)}}),[i.alive]),{state:i}})),te=function(){return Object(i.jsx)(ee,{})},ne=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,18)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};f.a.render(Object(i.jsx)(u.a.StrictMode,{children:Object(i.jsx)(te,{})}),document.getElementById("root")),ne()}},[[17,1,2]]]);
//# sourceMappingURL=main.91633b59.chunk.js.map