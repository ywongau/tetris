(this.webpackJsonptetris=this.webpackJsonptetris||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var a,r,c,i=n(1),o=n(2),u=n.n(o),l=n(8),s=n.n(l),d=(n(15),n(16),n.p+"static/media/clear1.fe1236db.mp3"),f=n.p+"static/media/clear2.42d27630.mp3",p=n.p+"static/media/clear3.50cd846e.mp3",m=n.p+"static/media/clear4.529df8a4.mp3",h=n.p+"static/media/gameOver.f52cf5f0.mp3",j=n.p+"static/media/hardDrop.d2d4cb32.mp3",v=n.p+"static/media/locked.f92eb651.mp3",g=n.p+"static/media/spawn.dcb5ecc2.mp3",b=n(4),O=n(0),y=function(e,t){var n=t.length;return e.shape.some((function(a,r){return a.some((function(a,c){return a&&(r+e.top>=n-1||t[r+e.top+1][c+e.left])}))}))},w=n(3),k=function(e,t,n){return function(e,t){var n=t[0].length,a=t.length;return!e.shape.some((function(r,c){return r.some((function(r,i){return r&&(i+e.left<0||i+e.left>=n||c+e.top>=a||t[c+e.top][i+e.left])}))}))}(e,n)?e:t},x=function(e,t){return k(Object(O.a)(Object(O.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,a){return e.shape[e.shape.length-1-a][n]}))}))}),e,t)},N=37,A=39,L=40,C=(a={},Object(w.a)(a,N,{left:-1,top:0}),Object(w.a)(a,A,{left:1,top:0}),Object(w.a)(a,L,{left:0,top:1}),a),D=function(e,t,n){return k(Object(O.a)(Object(O.a)({},e),{},{left:e.left+C[n].left,top:e.top+C[n].top}),e,t)},E=function(e,t){return t.map((function(t,n){return t.map((function(t,a){var r;return t||(null===(r=e.shape[n-e.top])||void 0===r?void 0:r[a-e.left])}))}))},P=function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.top,r=Object(O.a)(Object(O.a)({},t),{},{top:a});return y(r,n)?r:e(t,n,a+1)},T=function(e,t){return Object(b.a)(Array(t)).map((function(){return Object(b.a)(Array(e)).map((function(){}))}))},q={spawning:"spawning",descending:"descending",locking:"locking",clearing:"clearing",gameOver:"gameOver",starting:"starting",pending:void 0},I=function(e){var t=function(e,t){var n=y(e,t);return{playfield:n?E(e,t):t,locked:n}}(e.tetromino,e.playfield);return t.locked?Object(O.a)(Object(O.a)({},e),{},{tetromino:void 0,ghostPiece:void 0,playfield:t.playfield,sfx:"locked",phase:q.clearing}):Object(O.a)(Object(O.a)({},e),{},{phase:q.descending})},M={tick:function(e){var t=e.tetromino,n=e.playfield,a=D(t,n,L);return Object(O.a)(Object(O.a)({},e),{},{tetromino:a,phase:y(a,n)?q.locking:q.descending})},move:function(e,t){var n=e.tetromino,a=e.playfield,r=D(n,a,t.payload);return e.phase===q.locking&&t.payload===L?I(e):Object(O.a)(Object(O.a)({},e),{},{tetromino:r,ghostPiece:P(r,a),phase:y(r,a)?q.locking:q.descending})},lock:I,clear:function(e){var t=function(e){var t=e[0].length,n=e.reduceRight((function(e,t){return t.every((function(e){return e}))?e:[t].concat(e)}),[]),a=e.length-n.length;return{playfield:T(t,a).concat(n),linesCleared:a}}(e.playfield),n=e.lines+t.linesCleared;return Object(O.a)(Object(O.a)({},e),{},{playfield:t.playfield,lines:n,sfx:t.linesCleared>0?"clear"+t.linesCleared:void 0,interval:Math.max(100,1e3-100*Math.floor(n/10)),phase:q.spawning})},rotateRight:function(e){var t=e.tetromino,n=e.playfield,a=x(t,n);return Object(O.a)(Object(O.a)({},e),{},{tetromino:x(t,n),ghostPiece:P(a,n)})},rotateLeft:function(e){var t=e.tetromino,n=e.playfield,a=function(e,t){return k(Object(O.a)(Object(O.a)({},e),{},{shape:e.shape.map((function(t,n){return t.map((function(t,a){return e.shape[a][e.shape.length-1-n]}))}))}),e,t)}(t,n);return Object(O.a)(Object(O.a)({},e),{},{tetromino:a,ghostPiece:P(a,n)})},spawn:function(e,t){var n=e.queue,a=e.playfield,r=n[0],c=n.slice(1).concat(t.payload||[]),i=function(e,t){return!e.shape.some((function(n,a){return n.some((function(n,r){return n&&t[a+e.top][r+e.left]}))}))}(r,a);return Object(O.a)(Object(O.a)({},e),{},{tetromino:r,ghostPiece:P(r,a),phase:i?q.descending:q.gameOver,sfx:i?"spawn":"gameOver",queue:c,alive:i})},hardDrop:function(e){var t=e.tetromino,n=e.playfield,a=P(t,n);return Object(O.a)(Object(O.a)({},e),{},{tetromino:a,sfx:"hardDrop",phase:q.locking})},start:function(e,t){return{playfield:Object(b.a)(Array(20)).map((function(){return Object(b.a)(Array(10)).map((function(){}))})),queue:t.payload,phase:q.starting,tetromino:void 0,alive:!0,interval:1e3,lines:0,countdown:3}},countdown:function(e){return Object(O.a)(Object(O.a)({},e),{},{countdown:Math.max(0,e.countdown-1)})}},R={tick:[q.descending],move:[q.descending,q.locking],lock:[q.locking],clear:[q.clearing],rotateLeft:[q.descending,q.locking],rotateRight:[q.descending,q.locking],spawn:[q.spawning,q.starting],hardDrop:[q.descending],start:[q.pending,q.gameOver],countdown:[q.starting]},F=function(e,t){var n;return(null===(n=R[t.type])||void 0===n?void 0:n.includes(e.phase))?M[t.type](e,t):e},S={playfield:Object(b.a)(Array(20)).map((function(){return Object(b.a)(Array(10)).map((function(){}))})),queue:[],phase:q.pending,tetromino:void 0,alive:!1,interval:1e3,lines:0,countdown:0},B=function(e){return function(){var t=e(),n=t.state,a=t.start,r=function(e,t,n){var a;return e&&(null===(a=e.shape[n-e.top])||void 0===a?void 0:a[t-e.left])};return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("main",{className:"frame",children:[Object(i.jsx)("div",{"data-testid":"playfield",className:"playfield",children:n.playfield.map((function(e,t){return Object(i.jsx)("div",{className:"row"+("clearing"===n.phase&&e.every((function(e){return e}))?" clearing":""),children:e.map((function(e,a){return Object(i.jsx)("div",{className:r(n.tetromino,a,t)||(r(n.ghostPiece,a,t)?"ghost-piece":"")||e||""},a)}))},t)}))}),n.phase===q.pending||n.phase===q.gameOver?Object(i.jsx)("div",{className:"controls",children:Object(i.jsx)("button",{onClick:a,children:"PLAY"})}):null,n.countdown>0?Object(i.jsx)("div",{className:"countdown",children:n.countdown}):null]}),Object(i.jsxs)("div",{className:"frame",children:[Object(i.jsx)("h1",{children:"NEXT"}),Object(i.jsx)("div",{className:"next-tetrominoes",children:n.queue.slice(0,3).map((function(e,t){return Object(i.jsx)("div",{className:"next-tetromino",children:e.shape.map((function(e,t){return Object(i.jsx)("div",{className:"row",children:e.map((function(e,t){return Object(i.jsx)("div",{className:e},t)}))},t)}))},t)}))}),Object(i.jsx)("h1",{children:"LINES"}),Object(i.jsx)("div",{className:"lines",children:n.lines})]})]})}},J=n(9),U={ArrowLeft:N,ArrowRight:A,ArrowDown:L},X=void 0,Y="O",Z={top:0,left:4,name:Y,shape:[[Y,Y],[Y,Y]]},z="I",G={top:0,left:3,name:z,shape:[[X,X,X,X],[z,z,z,z],[X,X,X,X],[X,X,X,X]]},H="S",K={top:0,left:3,name:H,shape:[[X,H,H],[H,H,X],[X,X,X]]},Q="Z",V={top:0,left:3,name:Q,shape:[[Q,Q,X],[X,Q,Q],[X,X,X]]},W="T",$={top:0,left:3,name:W,shape:[[X,W,X],[W,W,W],[X,X,X]]},_="J",ee={top:0,left:3,name:_,shape:[[_,X,X],[_,_,_],[X,X,X]]},te="L",ne={top:0,left:3,name:te,shape:[[X,X,te],[te,te,te],[X,X,X]]},ae=function(e){var t=new e,n=function(e){var n=function(e){return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return t.decodeAudioData(e)}))}(e);return function(){return n.then((function(e){var n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start()}))}};return{clear1:n(d),clear2:n(f),clear3:n(p),clear4:n(m),locked:n(v),spawn:n(g),hardDrop:n(j),gameOver:n(h)}}(AudioContext),re=B((r=ae,c=function(){return function(e){for(var t=e.slice(0),n=t.slice(0).length-1;n>=0;){var a=Math.floor(Math.random()*(n+1)),r=t[n];t[n]=t[a],t[a]=r,n-=1}return t}([G,Z,$,K,V,ee,ne])},function(){var e=Object(o.useReducer)(F,S),t=Object(J.a)(e,2),n=t[0],a=t[1],i=void 0!==n.tetromino;return Object(o.useEffect)((function(){var e=n.alive&&i?setInterval((function(){return a({type:"tick"})}),n.interval):0;return function(){return clearInterval(e)}}),[n.alive,i,n.interval]),Object(o.useEffect)((function(){n.sfx&&r[n.sfx]()}),[n.sfx]),Object(o.useEffect)((function(){var e,t,r=(e={},Object(w.a)(e,q.spawning,(function(){return setTimeout((function(){return a({type:"spawn",payload:n.queue.length<=3?c():[]})}),500)})),Object(w.a)(e,q.locking,(function(){return setTimeout((function(){return a({type:"lock"})}),500)})),Object(w.a)(e,q.clearing,(function(){return setTimeout((function(){return a({type:"clear"})}),500)})),Object(w.a)(e,q.starting,(function(){n.countdown>0?setTimeout((function(){return a({type:"countdown"})}),1e3):a({type:"spawn",payload:c()})})),e);null===(t=r[n.phase])||void 0===t||t.call(r)}),[n.phase,n.queue.length,n.countdown]),Object(o.useEffect)((function(){var e=function(e){U[e.key]&&a({type:"move",payload:U[e.key]}),"ArrowUp"===e.key&&a({type:"rotateRight"})," "===e.key&&a({type:"hardDrop"})};return n.alive&&document.body.addEventListener("keydown",e),function(){return document.body.removeEventListener("keydown",e)}}),[n.alive]),{state:n,start:function(){return a({type:"start",payload:c()})}}})),ce=function(){return Object(i.jsx)(re,{})},ie=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,18)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};s.a.render(Object(i.jsx)(u.a.StrictMode,{children:Object(i.jsx)(ce,{})}),document.getElementById("root")),ie()}},[[17,1,2]]]);
//# sourceMappingURL=main.2115caff.chunk.js.map